{"version":3,"sources":["../../server/models/Follow.js"],"names":["followSchema","_user","required","type","ObjectId","ref","_followed","String","default","createdAt","Date","now","isDeleted","Boolean","toJSON","virtuals","plugin","autoPopulate","next","where","populate","path","select","pre","post","model","Promise","all","findByIdAndUpdate","$push","_following","_followers","then","catch","Error","$pull","Follow"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,eAAe,qBAAW;AAC7BC,WAAM;AACFC,kBAAU,IADR;AAEFC,cAAM,iBAAOC,QAFX,EAEqBC,KAAI;AAFzB,KADuB;AAK5BC,eAAW;AACPJ,kBAAU,IADH;AAEPC,cAAM,iBAAOC,QAFN,EAEgBC,KAAI;AAFpB,KALiB;AAS5BF,UAAM;AACHA,cAAMI,MADH;AAEJC,iBAAS;AAFL,KATsB;AAa5BC,eAAW;AACPN,cAAMO,IADC;AAEPF,iBAASE,KAAKC;AAFP,KAbiB;AAiB5BC,eAAW;AACRT,cAAMU,OADE;AAEPL,iBAAS;AAFF;AAjBiB,CAAX,EAqBlB,EAAEM,QAAQ,EAAEC,UAAU,IAAZ,EAAV,EArBkB,CAArB;;AAuBAf,aAAagB,MAAb;;AAEA,IAAMC,eAAe,SAAfA,YAAe,CAAUC,IAAV,EAAgB;AACjC,SAAKC,KAAL,CAAW,EAACP,WAAW,KAAZ,EAAX,EACKQ,QADL,CACc;AACNC,cAAM,OADA;AAENC,gBAAQ;AAFF,KADd,EAIOF,QAJP,CAIgB;AACZC,cAAM,WADM;AAEZC,gBAAQ;AAFI,KAJhB;AAQAJ;AACH,CAVD;AAWAlB,aAAauB,GAAb,CAAiB,MAAjB,EAAyBN,YAAzB;;AAEAjB,aAAauB,GAAb,CAAiB,SAAjB,EAA4BN,YAA5B;;AAEAjB,aAAawB,IAAb,CAAkB,MAAlB,EAA0B,UAACC,KAAD,EAAQP,IAAR,EAAiB;AACvCQ,YAAQC,GAAR,CAAY,CACR,eAAKC,iBAAL,CAAuBH,MAAMxB,KAA7B,EAAoC;AAChC4B,eAAO;AACHC,wBAAYL,MAAMnB;AADf;AADyB,KAApC,CADQ,EAMR,eAAKsB,iBAAL,CAAuBH,MAAMnB,SAA7B,EAAwC;AACpCuB,eAAO;AACHE,wBAAYN,MAAMxB;AADf;AAD6B,KAAxC,CANQ,CAAZ,EAWG+B,IAXH,CAWQ,YAAM;AACVd;AACH,KAbD,EAaGe,KAbH,CAaS,iBAAS;;AAEd,cAAM,IAAIC,KAAJ,CAAU,EAAV,CAAN;AACH,KAhBD;AAkBH,CAnBD;;AAqBAlC,aAAauB,GAAb,CAAiB,QAAjB,EAA2B,UAAUL,IAAV,EAAgB;AACvCQ,YAAQC,GAAR,CAAY,CACR,eAAKC,iBAAL,CAAuB,KAAK3B,KAA5B,EAAmC;AAC/BkC,eAAO;AACHL,wBAAY,KAAKxB;AADd;AADwB,KAAnC,CADQ,EAMR,eAAKsB,iBAAL,CAAuB,KAAKtB,SAA5B,EAAuC;AACnC6B,eAAO;AACHJ,wBAAY,KAAK9B;AADd;AAD4B,KAAvC,CANQ,CAAZ,EAWG+B,IAXH,CAWQ,YAAM;AACVd;AACH,KAbD,EAaGe,KAbH,CAaS,iBAAS;AACd,cAAM,IAAIC,KAAJ,CAAU,EAAV,CAAN;AACH,KAfD;AAgBH,CAjBD;;AAmBA,IAAME,SAAS,mBAASX,KAAT,CAAe,QAAf,EAAyBzB,YAAzB,CAAf;kBACeoC,M","file":"Follow.js","sourcesContent":["import mongoose, { Schema } from 'mongoose';\nimport mongoosePaginate from 'mongoose-paginate';\nimport User from './User';\n\nconst followSchema = new Schema({\n   _user:{\n       required: true,\n       type: Schema.ObjectId, ref:'User'\n   },\n    _followed: {\n        required: true,\n        type: Schema.ObjectId, ref:'User'\n    },\n    type: {\n       type: String,\n      default: 'friend'\n    },\n    createdAt: {\n        type: Date,\n        default: Date.now\n    },\n    isDeleted: {\n       type: Boolean,\n        default: false\n    }\n}, { toJSON: { virtuals: true } });\n\nfollowSchema.plugin(mongoosePaginate);\n\nconst autoPopulate = function (next) {\n    this.where({isDeleted: false})\n        .populate({\n            path: '_user',\n            select: 'thumbnail username firstName lastName displayName _id createdAt'\n        }).populate({\n        path: '_followed',\n        select: 'thumbnail username firstName lastName displayName _id createdAt'\n    });\n    next()\n};\nfollowSchema.pre('find', autoPopulate);\n\nfollowSchema.pre('findOne', autoPopulate);\n\nfollowSchema.post('save', (model, next) => {\n    Promise.all([\n        User.findByIdAndUpdate(model._user, {\n            $push: {\n                _following: model._followed\n            }\n        }),\n        User.findByIdAndUpdate(model._followed, {\n            $push: {\n                _followers: model._user\n            }\n        })\n    ]).then(() => {\n        next()\n    }).catch(error => {\n\n        throw new Error(\"\")\n    })\n\n});\n\nfollowSchema.pre('remove', function( next) {\n    Promise.all([\n        User.findByIdAndUpdate(this._user, {\n            $pull: {\n                _following: this._followed\n            }\n        }),\n        User.findByIdAndUpdate(this._followed, {\n            $pull: {\n                _followers: this._user\n            }\n        })\n    ]).then(() => {\n        next()\n    }).catch(error => {\n        throw new Error(\"\")\n    })\n});\n\nconst Follow = mongoose.model('Follow', followSchema);\nexport default Follow;"]}